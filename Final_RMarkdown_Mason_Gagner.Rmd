---
title: "Mortality Rates Compared Between Vaccinated and Unvaccinated Infants"
author: "Mason Gagner"
date: "`r Sys.Date()`"
output:
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# ABSTRACT

<!--Fill in abstract at the end after we have finished the methods, results, discussion, conclusions and know what our data "says".-->


# BACKGROUND

<!--Fill in some text here that provides background info on the WNV system, the blood meal DNA extractions, PCR, sequencing, etc. and the foundation for our question/hypothesis.

NOTE: Examples of data you can plot for the background info at https://github.com/saarman/BIOL3070/ -->
Infant mortality stands as a key indicator of a nation’s overall health and development. Many factors can contribute to the health and life expectancy of people, such as hygiene driven by cultural and technological norms and advancement. Introduction of global vaccination initiatives such as the Expanded Programme on Immunization (EPI) in 1974 has been linked to reductions in preventable childhood deaths (World Health Organization). While there are many studies to confirm the efficacy of vaccines, long-term impact is determined by comparing historical trends of mortality rates.
  
```{r}
```


# STUDY QUESTION and HYPOTHESIS

## Question  
<!--Fill in here, the question we want to answer... e.g. What bird species is acting as WNV amplifying host in Salt Lake City?-->
Between vaccinated and non-vaccinated groups, who shows a more significant decline in child mortality rates?

## Hypothesis 
<!--Fill in hypothesis... e.g. House finches are acting as important amplifying hosts of WNV in Salt Lake City.-->
Infants that are vaccinated will show a more significant decline in mortality rates compared to those who are unvaccinated.

## Prediction
<!--Fill in prediction... e.g. If house finches are acting as important amplifying hosts, we predict that trapping locations where mosquitoes feed on house finches will also have higher rates of confirmed WNV in tested mosquito pools.-->
If vaccines are effective at reducing mortality rates in infants, we will see a more significant decline in the mortality for those who are vaccinated compared to not.

# METHODS

<!--Fill in here, including overview of procedure and methods used for this project.
-->

## First Analysis

### Comparing Infant Mortality Rates: Line Graph

```{r linear.plot,fig.align='left',fig.width=10,fig.height=7, warning=FALSE}
library(ggplot2)
library(tidyr)

data <- read.csv("Globalinfantmortalityrate.csv")

# Change the formatting for graph type
data_long <- pivot_longer(data,
                          cols = c("Vaccinated.Mortality.Rate", "Unvaccinated.Mortality.Rate"),
                          names_to = "Group",
                          values_to = "MortalityRate")

# Creating the plot
ggplot(data_long, aes(x = Year, y = MortalityRate, color = Group)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  
  # Solid Axis Lines and line spacing
  geom_hline(yintercept = 0, color = "black", size = 0.6) +
  geom_vline(xintercept = min(data_long$Year), color = "black", size = 0.6) +
  
  scale_y_continuous(
    limits = c(0, 11),
    breaks = seq(0, 11, by = 0.5),   
    minor_breaks = NULL              
  ) +
  scale_x_continuous(
    breaks = seq(min(data_long$Year), max(data_long$Year), by = 10),  
    minor_breaks = data_long$Year                                     
  ) +
  
  # Line colors for the faded/more solid colored lines
  theme_minimal(base_size = 12) +
  theme(
    panel.grid.minor = element_line(color = "gray90", size = 0.2),
    panel.grid.major = element_line(color = "gray70", size = 0.4),   
    panel.border = element_blank(),                                  
    axis.line = element_blank()                                      
  ) +
  
  labs(
    title = "Global Infant Mortality Rate (Vaccinated vs Unvaccinated, 1974–2024)",
    x = "Year",
    y = "Mortality Rate (%)",
    color = "Group"
  )

```

## Second Analysis

### Linear Regression of Vaccinated compared to Unvaccinated

```{r}
data <- read.csv("Globalinfantmortalityrate.csv")

# Slope for Vaccinated
model_vax <- lm(Vaccinated.Mortality.Rate ~ Year, data = data)

# Slope for Unvaccinated
model_unvax <- lm(Unvaccinated.Mortality.Rate ~ Year, data = data)

summary(model_vax)$coefficients
summary(model_unvax)$coefficients

slope_vax <- coef(model_vax)[2]
slope_unvax <- coef(model_unvax)[2]

cat("Vaccinated slope:", slope_vax, "\n")
cat("Unvaccinated slope:", slope_unvax, "\n")

#If the p-value for that term is < 0.05, the slopes are significantly different.
#If the p-value is > 0.05, the slopes are not significantly different.

# Reshape the data
data_long <- data.frame(
  Year = rep(data$Year, 2),
  Mortality = c(data$Vaccinated.Mortality.Rate, data$Unvaccinated.Mortality.Rate),
  Group = rep(c("Vaccinated", "Unvaccinated"), each = nrow(data))
)
model <- lm(Mortality ~ Year * Group, data = data_long)
summary(model)
```

```{r mortality_plot, fig.width=12, fig.height=6, warning=FALSE}

library(ggplot2)
library(dplyr)

# Calculate slope and intercept for each group
equations <- data_long %>%
  group_by(Group) %>%
  do(model = lm(Mortality ~ Year, data = .)) %>%
  summarize(
    Group,
    Intercept = coef(model)[1],
    Slope = coef(model)[2]
  )

# Clean up group names and make equation labels
equations <- equations %>%
  mutate(
    Group = recode(Group,
                   "Vaccinated.Mortality.Rate" = "Vaccinated",
                   "Unvaccinated.Mortality.Rate" = "Unvaccinated"),
    label = paste0(Group, " (y = ",
                   round(Slope, 3), "x + ",
                   round(Intercept, 2), ")")
  )

# Merge labels back into main dataset
data_long_labeled <- data_long %>%
  left_join(equations, by = "Group")

# Plot design
ggplot(data_long_labeled, aes(x = Year, y = Mortality, color = label)) +
  geom_point(size = 2) +
  geom_smooth(method = "lm", se = FALSE, lwd = 1.2) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(hjust = 0.5)  # centers the title
  ) +
  labs(
    title = "Comparison of Mortality Rate Trends Over Time",
    y = "Mortality Rate (%)",
    x = "Year",
    color = "Group Regression Equation"
  )
```


# DISCUSSION


## Interpretation - First Analysis


## Interpretation - Second Analysis


# CONCLUSION


# REFERENCES     

OpenAI. (2025). ChatGPT (Oct 2025 version) [Large language model]. OpenAI. https://chat.openai.com/ (Used for general structuring and grammatical checking)

Shattock et al. (2024). Contribution of vaccination to improved survival and health: modelling 50 years of the Expanded Programme on Immunization. – processed by Our World in Data. “Global infant mortality rate with and without vaccines” [dataset]. Shattock et al. (2024). Contribution of vaccination to improved survival and health: modelling 50 years of the Expanded Programme on Immunization., “infant_mortality_vaccination_shattock” [original data]. Retrieved October 28, 2025 from https://archive.ourworldindata.org/20250909-093708/grapher/infant-mortality-vaccines.html (archived on September 9, 2025).

World Health Organization. (n.d.). Essential Programme on immunization. World Health Organization. https://www.who.int/teams/immunization-vaccines-and-biologicals/essential-programme-on-immunization 